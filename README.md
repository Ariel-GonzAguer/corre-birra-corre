# üç∫ Corre Birra Corre

## üìñ Gu√≠a Completa: C√≥mo Crear un Juego Side-Scrolling con KaPlay

Este es un tutorial completo para crear un juego de plataformas estilo "endless runner" usando **KaPlay** (anteriormente Kaboom.js). El proyecto "Corre Birra Corre" le ense√±ar√° a implementar mec√°nicas de juego modernas, controles t√°ctiles para m√≥viles, y un sistema de escenas completo.

![Corre Birra Corre](./public/sprites/gatoRojoLab-logo.png)

---

## üéÆ Sobre el Juego

**Corre Birra Corre** es un juego de plataformas donde controlas una cerveza que debe evitar obst√°culos mientras corre infinitamente. Incluye:

- ‚úÖ Controles para teclado y dispositivos t√°ctiles
- ‚úÖ Sistema de vidas y puntuaci√≥n
- ‚úÖ Generaci√≥n procedural de enemigos
- ‚úÖ Responsive design para m√∫ltiples pantallas
- ‚úÖ M√∫ltiples escenas (men√∫, juego, game over)
- ‚úÖ Detecci√≥n de colisiones
- ‚úÖ Efectos de gravedad y f√≠sicas

---

## üõ†Ô∏è Tecnolog√≠as Utilizadas

- **[KaPlay v3001.0.19](https://kaplayjs.com/)** - Motor de juegos 2D
- **TypeScript** - Lenguaje de programaci√≥n tipado
- **Vite** - Herramienta de desarrollo y build
- **HTML5 Canvas** - Renderizado gr√°fico

---

## üìã Requisitos Previos

Antes de comenzar, aseg√∫rese de tener:

- **Node.js** (versi√≥n 16 o superior)
- **pnpm** o **npm** para manejo de dependencias
- Editor de c√≥digo (VS Code recomendado)
- Conocimientos b√°sicos de JavaScript/TypeScript

---

## üöÄ Instalaci√≥n y Configuraci√≥n

### 1. Clonar o Crear el Proyecto

```bash
# Opci√≥n 1: Clonar este repositorio
git clone https://github.com/su-usuario/corre-birra-corre.git
cd corre-birra-corre

# Opci√≥n 2: Crear desde cero
mkdir mi-juego-kaplay
cd mi-juego-kaplay
npm init -y
```

### 2. Instalar Dependencias

```bash
# Instalar KaPlay y dependencias
pnpm install kaplay
pnpm install -D typescript vite @types/node vite-plugin-checker

# O usando npm
npm install kaplay
npm install -D typescript vite @types/node vite-plugin-checker
```

### 3. Configurar package.json

```json
{
  "name": "mi-juego-kaplay",
  "type": "module",
  "scripts": {
    "build": "vite build",
    "dev": "vite",
    "preview": "vite preview",
    "type-check": "tsc --noEmit"
  },
  "dependencies": {
    "kaplay": "^3001.0.19"
  },
  "devDependencies": {
    "typescript": "^5.9.2",
    "vite": "^7.1.7"
  }
}
```

### 4. Estructura de Archivos

```
mi-juego-kaplay/
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îî‚îÄ‚îÄ sprites/           # Im√°genes del juego
‚îÇ       ‚îú‚îÄ‚îÄ fondo-menu.png
‚îÇ       ‚îú‚îÄ‚îÄ fondo-juego.png
‚îÇ       ‚îú‚îÄ‚îÄ cerveza.png
‚îÇ       ‚îî‚îÄ‚îÄ enemigo.png
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main.ts           # Archivo principal
‚îÇ   ‚îî‚îÄ‚îÄ types/
‚îÇ       ‚îî‚îÄ‚îÄ global.d.ts   # Definiciones de tipos
‚îú‚îÄ‚îÄ index.html
‚îú‚îÄ‚îÄ vite.config.js
‚îú‚îÄ‚îÄ tsconfig.json
‚îî‚îÄ‚îÄ package.json
```

---

## üèóÔ∏è Arquitectura del Juego

### Conceptos Fundamentales de KaPlay

#### 1. **Inicializaci√≥n**
```typescript
import kaplay from "kaplay";

// Inicializar KaPlay
const k = kaplay({
  width: 1024,
  height: 768,
  canvas: document.querySelector("#game-canvas"),
});

// Hacer funciones disponibles globalmente
Object.assign(globalThis, k);
```

#### 2. **Sistema de Componentes**
En KaPlay, los objetos del juego se crean combinando componentes:

```typescript
const player = add([
  sprite("player"),        // Sprite visual
  pos(100, 300),          // Posici√≥n
  area(),                 // √Årea de colisi√≥n
  body(),                 // F√≠sicas/gravedad
  anchor("center"),       // Punto de anclaje
  scale(1),               // Escala
  "player"                // Tag para identificaci√≥n
]);
```

#### 3. **Carga de Assets**
```typescript
// Cargar sprites
loadSprite("player", "./sprites/player.png");
loadSprite("background", "./sprites/background.png");
loadSprite("enemy", "./sprites/enemy.png");
```

---

## üéØ Implementaci√≥n Paso a Paso

### Paso 1: Configuraci√≥n Inicial

#### `vite.config.js`
```javascript
import { defineConfig } from 'vite';
import checker from 'vite-plugin-checker';

export default defineConfig({
  plugins: [
    checker({
      typescript: true,
    }),
  ],
  base: './',
  build: {
    outDir: 'dist',
    assetsDir: 'assets',
  },
});
```

#### `tsconfig.json`
```json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true
  },
  "include": ["src"]
}
```

### Paso 2: Definir Tipos de KaPlay

#### `src/types/global.d.ts`
```typescript
// Definir tipos para funciones de KaPlay
declare function kaplay(options?: any): any;
declare function add(components: any[]): any;
declare function scene(name: string, callback: () => void): void;
declare function go(sceneName: string): void;
declare function loadSprite(name: string, src: string): void;
declare function sprite(name: string): any;
declare function pos(x: number, y: number): any;
declare function area(options?: any): any;
declare function body(): any;
declare function anchor(point: string): any;
declare function scale(factor: number): any;
declare function text(content: string, options?: any): any;
declare function rect(width: number, height: number): any;
declare function color(r: number, g: number, b: number): any;
declare function opacity(value: number): any;
declare function onKeyPress(key: string, callback: () => void): void;
declare function onMousePress(callback: () => void): void;
declare function onMouseRelease(callback: () => void): void;
declare function onUpdate(callback: () => void): void;
declare function mousePos(): { x: number; y: number };
declare function width(): number;
declare function height(): number;
declare function setGravity(force: number): void;
declare function health(points: number): any;
declare function move(direction: any, speed: number): any;

// Constantes de direcci√≥n
declare const LEFT: any;
declare const RIGHT: any;
```

### Paso 3: Estructura Base del Juego

#### `src/main.ts` - Configuraci√≥n inicial
```typescript
import kaplay from "kaplay";

// Inicializar KaPlay
const k = kaplay({
  width: 1024,
  height: 768,
  canvas: document.querySelector("#game-canvas"),
  crisp: true
});

// Hacer funciones disponibles globalmente
Object.assign(globalThis, k);

// Cargar todos los sprites
loadSprite("fondo-menu", "./sprites/fondo-menu.png");
loadSprite("fondo-juego", "./sprites/fondo-juego.png");
loadSprite("cerveza", "./sprites/beer-sprite.png");
loadSprite("borracho", "./sprites/borracho.png");
loadSprite("gato-logo", "./sprites/gatoRojoLab-logo.png");
```

### Paso 4: Implementar Fondos Responsivos

```typescript
// Funci√≥n para crear fondos responsivos
async function createResponsiveBackground(spriteName: string) {
  try {
    const sprite = await getSprite(spriteName);
    const scaleX = width() / sprite.width;
    const scaleY = height() / sprite.height;
    const finalScale = Math.max(scaleX, scaleY);

    add([
      sprite(spriteName),
      pos(width() / 2, height() / 2),
      scale(finalScale),
      anchor("center"),
      z(0)
    ]);
  } catch (error) {
    console.error(`Error loading sprite ${spriteName}:`, error);
  }
}
```

### Paso 5: Sistema de Escenas

#### Escena del Men√∫
```typescript
scene("menu", async () => {
  // Crear fondo responsivo
  await createResponsiveBackground("fondo-menu");

  // Logo del juego
  add([
    sprite("gato-logo"),
    pos(width() / 2, height() * 0.3),
    scale(0.5),
    anchor("center"),
    z(1)
  ]);

  // T√≠tulo
  add([
    text("CORRE BIRRA CORRE", { size: 48 }),
    pos(width() / 2, height() * 0.6),
    anchor("center"),
    color(255, 255, 255),
    z(1)
  ]);

  // Instrucciones
  add([
    text("Presiona ENTER para jugar", { size: 24 }),
    pos(width() / 2, height() * 0.8),
    anchor("center"),
    color(255, 255, 255),
    z(1)
  ]);

  // Control para comenzar el juego
  onKeyPress("enter", () => go("juego"));
});
```

#### Escena Principal del Juego
```typescript
scene("juego", async () => {
  // Configurar gravedad
  setGravity(1900);

  // Crear fondo responsivo
  await createResponsiveBackground("fondo-juego");

  // Sistema de puntuaci√≥n
  let score = 0;
  add([rect(80, 40), pos(16, 16), color(0, 0, 0), opacity(0.5), z(5)]);
  const scoreLabel = add([
    text(score, { size: 32 }),
    pos(24, 24),
    color(255, 255, 255),
    z(6)
  ]);

  // Crear personaje principal
  const player = add([
    sprite("cerveza"),
    pos(0, height() - 60),
    area({ scale: 0.8 }),
    body(),
    health(3),
    anchor("botleft"),
    z(2),
    "player"
  ]);

  // Sistema de controles
  setupControls(player);
  
  // Sistema de enemigos
  setupEnemySpawning(player, scoreLabel);
});
```

### Paso 6: Sistema de Controles

#### Controles de Teclado
```typescript
function setupKeyboardControls(player: any) {
  let jumpCount = 0;
  const maxJumps = 1;

  // Movimiento horizontal
  player.onKeyPress("right", () => {
    player.pos.x += 30;
  });

  player.onKeyPress("left", () => {
    player.pos.x -= 30;
  });

  // Sistema de salto
  onKeyPress("space", () => {
    if (jumpCount < maxJumps) {
      player.jump(900);
      jumpCount++;
    }
  });

  // Resetear saltos al tocar el suelo
  const groundY = height() - 60;
  onUpdate(() => {
    if (player.pos && player.pos.y >= groundY - 1) {
      jumpCount = 0;
    }
  });
}
```

#### Controles T√°ctiles para M√≥viles
```typescript
function setupTouchControls(player: any, jumpCount: number, maxJumps: number) {
  // Detectar dispositivos m√≥viles
  const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 'ontouchstart' in window;
  
  if (!isMobile) return;

  // Crear botones t√°ctiles
  const jumpButton = add([
    rect(120, 120),
    pos(width() * 0.75, height() * 0.5),
    area(),
    color(255, 255, 255),
    opacity(0.8),
    anchor("center"),
    z(10),
    "jumpButton"
  ]);

  const leftButton = add([
    rect(100, 100),
    pos(width() * 0.15, height() * 0.5),
    area(),
    color(255, 255, 255),
    opacity(0.8),
    anchor("center"),
    z(10),
    "leftButton"
  ]);

  const rightButton = add([
    rect(100, 100),
    pos(width() * 0.35, height() * 0.5),
    area(),
    color(255, 255, 255),
    opacity(0.8),
    anchor("center"),
    z(10),
    "rightButton"
  ]);

  // Agregar iconos a los botones
  add([
    text("‚Üë", { size: 64 }),
    pos(width() * 0.75, height() * 0.5),
    anchor("center"),
    z(11)
  ]);

  // Eventos de toque
  onMousePress(() => {
    if (jumpButton.isHovering() && jumpCount < maxJumps) {
      player.jump(900);
      jumpCount++;
    }
    if (leftButton.isHovering()) {
      player.pos.x -= 30;
    }
    if (rightButton.isHovering()) {
      player.pos.x += 30;
    }
  });
}
```

### Paso 7: Sistema de Enemigos

```typescript
function setupEnemySpawning(player: any, scoreLabel: any) {
  let score = 0;
  
  function spawnEnemy() {
    const speed = 350;
    const enemyTypes = [
      {
        sprite: "borracho",
        scale: 0.8,
        points: 10
      }
    ];

    const enemyType = enemyTypes[Math.floor(Math.random() * enemyTypes.length)];
    
    const enemy = add([
      sprite(enemyType.sprite),
      pos(width(), height() - 60),
      area({ scale: enemyType.scale }),
      anchor("botleft"),
      move(LEFT, speed),
      z(2),
      "enemy",
      { points: enemyType.points }
    ]);

    // Eliminar enemigo cuando sale de pantalla
    enemy.onUpdate(() => {
      if (enemy.pos.x < -100) {
        destroy(enemy);
        score += enemyType.points;
        scoreLabel.text = score;
      }
    });

    // Colisi√≥n con el jugador
    enemy.onCollide("player", () => {
      player.hurt(1);
      destroy(enemy);
      
      if (player.hp() <= 0) {
        go("perdido");
      }
    });
  }

  // Generar enemigos cada 2 segundos
  const spawnTimer = loop(2, spawnEnemy);
}
```

### Paso 8: Escena de Game Over

```typescript
scene("perdido", async () => {
  await createResponsiveBackground("fondo-juego");

  add([
    rect(400, 200),
    pos(width() / 2, height() / 2),
    color(0, 0, 0),
    opacity(0.8),
    anchor("center"),
    z(5)
  ]);

  add([
    text("¬°PERDISTE!", { size: 48 }),
    pos(width() / 2, height() / 2 - 30),
    anchor("center"),
    color(255, 0, 0),
    z(6)
  ]);

  add([
    text("Presiona R para reiniciar", { size: 24 }),
    pos(width() / 2, height() / 2 + 30),
    anchor("center"),
    color(255, 255, 255),
    z(6)
  ]);

  onKeyPress("r", () => go("juego"));
});
```

---

## üé® Optimizaci√≥n y Mejores Pr√°cticas

### 1. **Gesti√≥n de Memoria**
```typescript
// Limpiar objetos cuando salen de pantalla
enemy.onUpdate(() => {
  if (enemy.pos.x < -100) {
    destroy(enemy); // Importante: destruir objetos no utilizados
  }
});
```

### 2. **Performance en M√≥viles**
```typescript
// Usar requestAnimationFrame para animaciones suaves
const k = kaplay({
  maxFPS: 60,        // Limitar FPS
  crisp: true,       // Pixeles n√≠tidos
  canvas: canvas,    // Canvas existente
  touchToMouse: true // Convertir touch en eventos de mouse
});
```

### 3. **Responsive Design**
```typescript
// Usar porcentajes en lugar de valores fijos
pos(width() * 0.5, height() * 0.3)  // Centro horizontal, 30% vertical

// Escalar sprites proporcionalmente
const finalScale = Math.max(scaleX, scaleY);
```

### 4. **Debugging**
```typescript
// Modo debug para ver colisiones
const k = kaplay({
  debug: true  // Mostrar √°reas de colisi√≥n
});

// Log de informaci√≥n √∫til
console.log("Player position:", player.pos);
console.log("Current scene:", getScene());
```

---

## üì± Soporte Multi-plataforma

### Desktop
- Controles: Teclado (Flechas, Espacio, Enter)
- Resoluci√≥n: Escalable autom√°ticamente
- Performance: √ìptima

### M√≥vil
- Controles: Botones t√°ctiles virtuales
- Detecci√≥n: User-Agent + touch events
- UI: Botones m√°s grandes y posicionados ergon√≥micamente

### Web
- Deployment: Build est√°tico con Vite
- Compatibilidad: Todos los navegadores modernos
- Carga: Assets optimizados

---

## üöÄ Deployment

### Build para Producci√≥n
```bash
pnpm run build
# Genera carpeta 'dist' con archivos est√°ticos
```

### Deploy en GitHub Pages
```bash
# En vite.config.js, configurar base URL
export default defineConfig({
  base: '/nombre-repositorio/',
  // ... resto de configuraci√≥n
});
```

### Deploy en Netlify/Vercel
```bash
# Comando de build
npm run build

# Directorio de salida
dist
```

---

## üîß Extensiones y Funcionalidades Adicionales

### Power-ups
```typescript
function createPowerUp(type: string, x: number, y: number) {
  const powerUp = add([
    sprite(type),
    pos(x, y),
    area(),
    "powerup",
    { type }
  ]);

  powerUp.onCollide("player", (player) => {
    switch(type) {
      case "speed":
        player.speed *= 1.5;
        break;
      case "health":
        player.heal(1);
        break;
    }
    destroy(powerUp);
  });
}
```

### Sistema de Niveles
```typescript
let currentLevel = 1;
let enemySpeed = 300;

function levelUp() {
  currentLevel++;
  enemySpeed += 50;
  
  add([
    text(`NIVEL ${currentLevel}`, { size: 36 }),
    pos(width() / 2, 50),
    anchor("center"),
    lifespan(3), // Desaparece en 3 segundos
    z(10)
  ]);
}
```

### Efectos de Sonido
```typescript
// Cargar sonidos
loadSound("jump", "./sounds/jump.wav");
loadSound("hurt", "./sounds/hurt.wav");

// Reproducir sonidos
onKeyPress("space", () => {
  play("jump", { volume: 0.5 });
  player.jump(900);
});
```

---

## üìö Recursos Adicionales

### Documentaci√≥n Oficial
- **[KaPlay Documentation](https://kaplayjs.com/guides/)**
- **[KaPlay Examples](https://kaplayjs.com/examples/)**
- **[TypeScript Handbook](https://www.typescriptlang.org/docs/)**

### Herramientas √ötiles
- **[Sprite Editor](https://www.piskelapp.com/)** - Editor de sprites online
- **[Tiled](https://www.mapeditor.org/)** - Editor de mapas
- **[Audacity](https://www.audacityteam.org/)** - Editor de audio

### Inspiraci√≥n
- **[itch.io](https://itch.io/)** - Juegos indie para inspirarse
- **[OpenGameArt](https://opengameart.org/)** - Assets gratuitos

---

## ü§ù Contribuir al Proyecto

### Setup de Desarrollo
```bash
git clone https://github.com/su-usuario/corre-birra-corre.git
cd corre-birra-corre
pnpm install
pnpm run dev
```

### Estructura de Commits
```
feat: agregar nuevos controles t√°ctiles
fix: corregir colisi√≥n de enemigos
docs: actualizar README
style: mejorar formato del c√≥digo
```

---

## üìÑ Licencia

Este proyecto est√° bajo la licencia MIT. Puede usar, modificar y distribuir libremente.

---

## üéØ Conclusi√≥n

Ha aprendido a crear un juego completo con KaPlay que incluye:

‚úÖ **Sistema de escenas** (men√∫, juego, game over)  
‚úÖ **Controles multi-plataforma** (teclado + t√°ctil)  
‚úÖ **F√≠sicas realistas** (gravedad, colisiones)  
‚úÖ **UI responsiva** (adaptable a cualquier pantalla)  
‚úÖ **Generaci√≥n procedural** (enemigos autom√°ticos)  
‚úÖ **Gesti√≥n de estado** (vidas, puntuaci√≥n)  
‚úÖ **Optimizaci√≥n** (performance y memoria)  

### Pr√≥ximos Pasos
1. **Agregar m√°s tipos de enemigos**
2. **Implementar sistema de power-ups**  
3. **Crear multiple levels**
4. **A√±adir efectos de sonido y m√∫sica**
5. **Implementar tabla de puntuaciones**

### ¬øPreguntas?
Si tiene dudas sobre la implementaci√≥n o desea contribuir al proyecto, no dude en abrir un issue en el repositorio.

**¬°Feliz desarrollo! üéÆ**

---

*Creado con ‚ù§Ô∏è usando [KaPlay](https://kaplayjs.com/) y TypeScript*